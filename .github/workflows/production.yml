name: "Deploy Frontend Production"

on:
  push:
    tags:
      - "1.*.*-*"

jobs:
  build-staging:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Extract Tag and Environment Variables
        id: vars
        run: |
          # 1. Get the full ref (e.g., 'refs/tags/2.5.0-1')
          FULL_REF="${{ github.ref }}"

          # 2. Extract the tag name by removing the 'refs/tags/' prefix
          # This uses bash string manipulation: ${variable#prefix_to_remove}
          TAG_CLEAN=${FULL_REF#refs/tags/}

          # 3. Define the environment
          ENV="production"

          # 4. Set the extracted values as step outputs for use in later steps
          echo "tag=$TAG_CLEAN" >> $GITHUB_OUTPUT
          echo "env=$ENV" >> $GITHUB_OUTPUT

          echo "Extracted Tag: $TAG_CLEAN"
          echo "Environment: $ENV"

      - name: Build Docker image
        run: |
          # ðŸ’¡ Use the step outputs from 'vars'
          TAG=${{ steps.vars.outputs.tag }} 
          ENV=${{ steps.vars.outputs.env }}

          echo "Building image for $ENV environment with tag $TAG"
